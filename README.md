# Deepfake-Detection
Deepfake-Detection


## Data Preparation
Get the download script [here](https://github.com/ondyari/FaceForensics)
- Download all video with compression rate factor 23
```
python3 download/download-Faceforensics.py ./download -d all -c c23 -t videos
```
The structure of Faceforencsics is as follows


```
├── Faceforensics
    ├── manipulated_sequences
    └── original_sequences
```


## Usage
Set the path in **env.py**
```
DOWNLOAD_DIR: path to Faceforensics/, which contains manipulated_suquences/ and original_sequences/
PREPRO_DIR: empty folder, the folder to save proprocessed data
```

### Data Preprocessing
- Randomly sample 20 pairs of consecutive frames from each video
- Crop face region according to the first frame
```
python3 crop_face.py
```

- Save optical flow generated by different methods (Farneback, FlowNet2.0, SPyNet, PWC-Net) on sampled consecutive image as npy file
  - clone [PWC-Net repository](https://github.com/sniklaus/pytorch-pwc) at root directory and download the pretrained model
  - clone [SPyNet repository](https://github.com/sniklaus/pytorch-spynet) at root directory and download the pretrained model
  - clone [FlowNet2.0 repository](https://github.com/NVIDIA/flownet2-pytorch) at root directory and download the pretrained model
```
python3 save_flow.py
```

### Train
- Train the CNN model on randomly sampled optical flow in the videos
- Classifier: Vgg11 or Resnet18
- Input: Need to set in **dataloader/dataloader.py** manually

```
python3 train.py -b <BATCH_SIZE> -e <EPOCH> -m <SAVED_MODEL_NAME> -l <MODEL_PATH> -n <NUM_DATA> -cpu
    -b <BATCH_SIZE>
        batch size used for training and validation
    -e <EPOCH>
        the number of epoch for training and validation
    -m <SAVED_MODEL_NAME>
        the model name (be saved in SAVED_MODEL_PATH)
    -l <MODEL_PATH>
        specified the model path if you want to load previous model
    -n <NUM_DATA>
        the number of data used for training. (set -1 if you want to use all the training data (85898))
    -cpu
        if you want to use CPU to train
```
### Test
- Evaluate the model on test split of Faceforensics++
```
python3 test.py -l <MODEL_PATH> -cpu
    -n <NUM_DATA>
        the number of data used for testing. (set -1 if you want to use all the testing data (1000))
    -l <MODEL_PATH>
        the path of loaded model
    -cpu   
        if you want to use CPU to test
```
